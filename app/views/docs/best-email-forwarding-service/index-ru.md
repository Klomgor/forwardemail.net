# Как Forward Email защищает вашу конфиденциальность, домен и безопасность: технический подробный анализ {#how-forward-email-protects-your-privacy-domain-and-security-the-technical-deep-dive}

<img загрузка="ленивый" src="/img/articles/email-forwarding.webp" alt="" class="rounded-lg" />

## Содержание {#table-of-contents}

* [Предисловие](#foreword)
* [Философия конфиденциальности пересылки электронных писем](#the-forward-email-privacy-philosophy)
* [Реализация SQLite: надежность и переносимость ваших данных](#sqlite-implementation-durability-and-portability-for-your-data)
* [Механизм интеллектуальной очереди и повторных попыток: обеспечение доставки электронной почты](#smart-queue-and-retry-mechanism-ensuring-email-delivery)
* [Неограниченные ресурсы с интеллектуальным ограничением скорости](#unlimited-resources-with-intelligent-rate-limiting)
* [Шифрование в изолированной среде для повышения безопасности](#sandboxed-encryption-for-enhanced-security)
* [Обработка электронной почты в памяти: отсутствие дискового хранилища для максимальной конфиденциальности](#in-memory-email-processing-no-disk-storage-for-maximum-privacy)
* [Сквозное шифрование с OpenPGP для полной конфиденциальности](#end-to-end-encryption-with-openpgp-for-complete-privacy)
* [Многоуровневая защита контента для комплексной безопасности](#multi-layered-content-protection-for-comprehensive-security)
* [Чем мы отличаемся от других почтовых сервисов: техническое преимущество конфиденциальности](#how-we-differ-from-other-email-services-the-technical-privacy-advantage)
  * [Прозрачность открытого исходного кода для проверяемой конфиденциальности](#open-source-transparency-for-verifiable-privacy)
  * [Отсутствие привязки к поставщику для обеспечения конфиденциальности без компромиссов](#no-vendor-lock-in-for-privacy-without-compromise)
  * [Изолированные данные для настоящей изоляции](#sandboxed-data-for-true-isolation)
  * [Переносимость и контроль данных](#data-portability-and-control)
* [Технические проблемы пересылки электронной почты с приоритетом конфиденциальности](#the-technical-challenges-of-privacy-first-email-forwarding)
  * [Управление памятью для обработки электронной почты без регистрации](#memory-management-for-no-logging-email-processing)
  * [Обнаружение спама без анализа контента для фильтрации, сохраняющей конфиденциальность](#spam-detection-without-content-analysis-for-privacy-preserving-filtering)
  * [Поддержание совместимости с дизайном Privacy-First](#maintaining-compatibility-with-privacy-first-design)
* [Лучшие практики обеспечения конфиденциальности для пользователей пересылаемой электронной почты](#privacy-best-practices-for-forward-email-users)
* [Заключение: будущее пересылки частной электронной почты](#conclusion-the-future-of-private-email-forwarding)

## Предисловие {#foreword}

В современном цифровом ландшафте конфиденциальность электронной почты стала более важной, чем когда-либо. С утечками данных, проблемами слежки и целевой рекламой на основе содержимого электронной почты пользователи все чаще ищут решения, которые ставят их конфиденциальность в приоритет. В Forward Email мы построили наш сервис с нуля, сделав конфиденциальность краеугольным камнем нашей архитектуры. В этой записи блога рассматриваются технические реализации, которые делают наш сервис одним из самых ориентированных на конфиденциальность решений для пересылки электронной почты из всех доступных.

## Философия конфиденциальности пересылки электронных писем {#the-forward-email-privacy-philosophy}

Прежде чем углубляться в технические детали, важно понять нашу фундаментальную философию конфиденциальности: **ваши электронные письма принадлежат вам и только вам**. Этот принцип определяет каждое принимаемое нами техническое решение, от того, как мы обрабатываем пересылку электронных писем, до того, как мы реализуем шифрование.

В отличие от многих поставщиков услуг электронной почты, которые сканируют ваши сообщения в рекламных целях или хранят их неограниченное время на своих серверах, Forward Email работает на основе радикально иного подхода:

1. **Только обработка в памяти** — мы не сохраняем ваши пересланные письма на диск
2. **Нет хранилища метаданных** — мы не ведем учет того, кто кому отправляет письма
3. **100% открытый исходный код** — вся наша кодовая база прозрачна и доступна для аудита
4. **Сквозное шифрование** — мы поддерживаем OpenPGP для действительно конфиденциальной связи

## Реализация SQLite: надежность и переносимость ваших данных {#sqlite-implementation-durability-and-portability-for-your-data}

Одним из важнейших преимуществ Forward Email в плане конфиденциальности является наша тщательно продуманная реализация [SQLite](https://en.wikipedia.org/wiki/SQLite). Мы доработали SQLite, используя специальные настройки PRAGMA и [Ведение журнала с опережающей записью (WAL)](https://en.wikipedia.org/wiki/Write-ahead_logging), чтобы обеспечить как надёжность, так и переносимость ваших данных, поддерживая при этом высочайшие стандарты конфиденциальности и безопасности.

Вот как мы реализовали SQLite с [ChaCha20-Poly1305](https://en.wikipedia.org/wiki/ChaCha20-Poly1305) в качестве шифра для квантово-устойчивого шифрования:

```javascript
// Initialize the database with better-sqlite3-multiple-ciphers
const Database = require('better-sqlite3-multiple-ciphers');

// Set up encryption with ChaCha20-Poly1305 cipher
db.pragma(`key="${decrypt(session.user.password)}"`);

// Enable Write-Ahead Logging for durability and performance
db.pragma('journal_mode=WAL');

// Overwrite deleted content with zeros for privacy
db.pragma('secure_delete=ON');

// Enable auto vacuum for efficient storage management
db.pragma('auto_vacuum=FULL');

// Set busy timeout for handling concurrent access
db.pragma(`busy_timeout=${config.busyTimeout}`);

// Optimize synchronization for reliability
db.pragma('synchronous=NORMAL');

// Enable foreign key constraints for data integrity
db.pragma('foreign_keys=ON');

// Set UTF-8 encoding for international character support
db.pragma(`encoding='UTF-8'`);

// Optimize database performance
db.pragma('optimize=0x10002;');

// Use disk for temporary storage instead of memory
db.pragma('temp_store=1;');
```

Эта реализация гарантирует не только безопасность, но и портативность ваших данных. Вы можете в любой момент забрать свою электронную почту с собой, экспортировав её в форматы [MBOX](https://en.wikipedia.org/wiki/Email#Storage), [EML](https://en.wikipedia.org/wiki/Email#Storage) или SQLite. А когда вы захотите удалить свои данные, они будут полностью удалены — мы просто удалим файлы с диска, а не будем выполнять SQL-команды DELETE ROW, которые могут оставить следы в базе данных.

Аспект квантового шифрования нашей реализации использует ChaCha20-Poly1305 в качестве шифра при инициализации базы данных, обеспечивая надежную защиту как от текущих, так и от будущих угроз конфиденциальности ваших данных.

## Механизм интеллектуальной очереди и повторных попыток: обеспечение доставки электронной почты {#smart-queue-and-retry-mechanism-ensuring-email-delivery}

Вместо того чтобы концентрироваться исключительно на обработке заголовков, мы внедрили сложный механизм интеллектуальной очереди и повторных попыток с помощью метода `getBounceInfo`. Эта система гарантирует максимальную вероятность доставки ваших писем, даже при возникновении временных проблем.

```javascript
function getBounceInfo(err) {
  // Initialize bounce info with default values
  const bounceInfo = {
    action: err.responseCode >= 500 ? 'reject' : 'defer',
    category: err.category || 'other',
    message: err.message,
    code: err.responseCode || err.code
  };

  // Analyze error response to determine appropriate action
  const response = err.response || err.message || '';

  // Determine if the issue is temporary or permanent
  if (response.includes('temporarily deferred') ||
      response.includes('try again later')) {
    bounceInfo.action = 'defer';
  }

  // Categorize the bounce reason for appropriate handling
  if (response.includes('mailbox full')) {
    bounceInfo.category = 'full';
    bounceInfo.action = 'defer';
  } else if (response.includes('user unknown')) {
    bounceInfo.category = 'unknown';
  }

  return bounceInfo;
}
```

> \[!NOTE]
> This is an excerpt of the `getBounceInfo` method and not the actual extensive implementation. For the complete code, you can review it on [GitHub](https://github.com/forwardemail/forwardemail.net/blob/master/helpers/get-bounce-info.js).

Мы повторяем попытки доставки почты в течение 5 дней, следуя отраслевым стандартам, таким как [Постфикс](https://en.wikipedia.org/wiki/Postfix_\(software\), давая временным проблемам время на решение. Такой подход значительно повышает скорость доставки, сохраняя при этом конфиденциальность.

Аналогично, мы также редактируем содержимое исходящих SMTP-писем после успешной доставки. Это настроено в нашей системе хранения с периодом хранения по умолчанию в 30 дней, который вы можете изменить в расширенных настройках вашего домена. По истечении этого периода содержимое письма автоматически редактируется и очищается, и остается только сообщение-заполнитель:

```txt
This message was successfully sent. It has been redacted and purged for your security and privacy. If you would like to increase your message retention time, please go to the Advanced Settings page for your domain.
```

Такой подход гарантирует, что отправленные вами электронные письма не будут храниться бесконечно, что снижает риск утечки данных или несанкционированного доступа к вашим сообщениям.

## Неограниченные ресурсы с интеллектуальным ограничением скорости {#unlimited-resources-with-intelligent-rate-limiting}

Хотя Forward Email предлагает неограниченное количество доменов и псевдонимов, мы внедрили интеллектуальное ограничение скорости, чтобы защитить нашу систему от злоупотреблений и обеспечить справедливое использование для всех пользователей. Например, некорпоративные клиенты могут создавать до 50+ псевдонимов в день, что предотвращает спам и переполнение нашей базы данных и позволяет нашим функциям защиты и злоупотреблений в реальном времени работать эффективно.

```javascript
// Rate limiter implementation
const rateLimiter = new RateLimiter({
  // Configuration settings
});

// Check rate limits before processing
const limit = await rateLimiter.get({
  key: `domain:${domain.id}`,
  duration: ms('1d')
});

// Apply appropriate action based on limit status
if (limit.remaining <= 0) {
  // Handle rate limit exceeded
}
```

Такой сбалансированный подход дает вам возможность создавать столько адресов электронной почты, сколько вам необходимо для комплексного управления конфиденциальностью, сохраняя при этом целостность и производительность нашего сервиса для всех пользователей.

## Шифрование в изолированной среде для повышения безопасности {#sandboxed-encryption-for-enhanced-security}

Наш уникальный подход к шифрованию в песочнице обеспечивает критическое преимущество безопасности, которое многие пользователи упускают из виду при выборе почтового сервиса. Давайте рассмотрим, почему так важно изолировать данные, особенно электронную почту.

Такие сервисы, как Gmail и Proton, скорее всего, используют общий [реляционные базы данных](https://en.wikipedia.org/wiki/Relational_database), что создаёт фундаментальную уязвимость безопасности. В среде с общей базой данных, если кто-то получает доступ к данным одного пользователя, у него потенциально появляется возможность получить доступ и к данным других пользователей. Это связано с тем, что все пользовательские данные находятся в одних и тех же таблицах базы данных и разделены только идентификаторами пользователей или аналогичными идентификаторами.

Пересылка электронной почты использует принципиально иной подход с нашим изолированным шифрованием:

1. **Полная изоляция**: данные каждого пользователя хранятся в его собственном зашифрованном файле базы данных SQLite, полностью изолированном от других пользователей
2. **Независимые ключи шифрования**: каждая база данных шифруется собственным уникальным ключом, полученным из пароля пользователя
3. **Отсутствие общего хранилища**: в отличие от реляционных баз данных, где все электронные письма пользователей могут находиться в одной таблице «emails», наш подход гарантирует отсутствие смешивания данных
4. **Глубокая защита**: даже если база данных одного пользователя каким-то образом будет скомпрометирована, она не предоставит доступ к данным любого другого пользователя

Этот подход с песочницей похож на то, как если бы ваша электронная почта находилась в отдельном физическом хранилище, а не в общем хранилище с внутренними разделителями. Это фундаментальное архитектурное различие, которое значительно повышает вашу конфиденциальность и безопасность.

## Обработка электронной почты в памяти: отсутствие дискового хранилища для максимальной конфиденциальности {#in-memory-email-processing-no-disk-storage-for-maximum-privacy}

Для нашей службы пересылки электронной почты мы обрабатываем электронные письма полностью в оперативной памяти и никогда не записываем их на дисковое хранилище или в базы данных. Такой подход обеспечивает непревзойденную защиту от слежки за электронной почтой и сбора метаданных.

Вот упрощенный взгляд на то, как работает наша обработка электронной почты:

```javascript
async function onData(stream, _session, fn) {
  // Store clone of session since it gets modified/destroyed
  const session = JSON.parse(safeStringify(_session));

  try {
    // Process the email stream in memory
    const messageSplitter = new MessageSplitter({
      maxBytes: MAX_BYTES
    });
    stream.pipe(messageSplitter);
    const body = await getStream.buffer(messageSplitter);

    const { headers } = messageSplitter;

    // Update session object with useful debug info for error logs
    await updateSession.call(this, body, headers, session);

    // Process the email without storing to disk
    // [Processing code omitted for brevity]

    // Return success without persisting email data
    fn();
  } catch (err) {
    // Handle errors without storing sensitive information
    fn(err);
  }
}
```

Такой подход означает, что даже если наши серверы будут скомпрометированы, у злоумышленников не останется исторических данных электронной почты, к которым они могли бы получить доступ. Ваши электронные письма просто проходят через нашу систему и немедленно пересылаются по назначению, не оставляя следов. Этот подход к пересылке электронной почты без регистрации имеет основополагающее значение для защиты ваших сообщений от слежки.

## Сквозное шифрование с OpenPGP для полной конфиденциальности {#end-to-end-encryption-with-openpgp-for-complete-privacy}

Для пользователей, которым требуется максимальная защита конфиденциальности от слежки за электронной почтой, мы поддерживаем [OpenPGP](https://en.wikipedia.org/wiki/Pretty_Good_Privacy) для сквозного шифрования. В отличие от многих почтовых провайдеров, которым требуются собственные мосты или приложения, наша реализация работает со стандартными почтовыми клиентами, делая безопасную переписку доступной каждому.

Вот как мы реализуем шифрование OpenPGP:

```javascript
async function encryptMessage(pubKeyArmored, raw, isArmored = true) {
  // [Initial validation code omitted for brevity]

  // Read the public key
  const pubKey = isArmored
    ? await openpgp.readKey({
        armoredKey: tools.prepareArmoredPubKey(pubKeyArmored),
        config: { tolerant: true }
      })
    : pubKeyArmored;

  if (!pubKey) throw new TypeError('Public key does not exist');

  // Perform the actual encryption using OpenPGP
  const ciphertext = await openpgp.encrypt({
    message: await openpgp.createMessage({
      binary: Buffer.concat([Buffer.from(bodyHeaders + '\r\n\r\n'), body])
    }),
    encryptionKeys: pubKey,
    format: 'armored',
    config: { minRSABits: 1024 }
  });

  // Format the encrypted message as a proper MIME message
  // [MIME formatting code omitted for brevity]

  return Buffer.concat([headers, breaker, Buffer.from(text)]);
}
```

Эта реализация гарантирует, что ваши электронные письма будут зашифрованы до того, как они покинут ваше устройство, и могут быть расшифрованы только предполагаемым получателем, сохраняя вашу коммуникацию конфиденциальной даже от нас. Это необходимо для защиты конфиденциальных сообщений от несанкционированного доступа и наблюдения.

## Многоуровневая защита контента для комплексной безопасности {#multi-layered-content-protection-for-comprehensive-security}

Пересылка электронной почты предлагает несколько уровней защиты контента, которые включены по умолчанию для обеспечения комплексной защиты от различных угроз:

1. **Защита от контента для взрослых** — отфильтровывает нежелательный контент без ущерба для конфиденциальности.
2. **Защита [Фишинг](https://en.wikipedia.org/wiki/Phishing)** — блокирует попытки кражи ваших данных, сохраняя анонимность.
3. **Защита исполняемых файлов** — предотвращает потенциально опасные вложения без сканирования контента.
4. **Защита [Вирус](https://en.wikipedia.org/wiki/Computer_virus)** — проверяет на наличие вредоносных программ, используя методы сохранения конфиденциальности.

В отличие от многих поставщиков, которые делают эти функции обязательными, мы сделали их необязательными, гарантируя, что все пользователи по умолчанию получат выгоду от этих мер защиты. Такой подход отражает нашу приверженность как конфиденциальности, так и безопасности, обеспечивая баланс, которого не удается достичь многим почтовым службам.

## Чем мы отличаемся от других почтовых сервисов: техническое преимущество конфиденциальности {#how-we-differ-from-other-email-services-the-technical-privacy-advantage}

При сравнении Forward Email с другими почтовыми сервисами можно выделить несколько ключевых технических отличий, подчеркивающих наш подход, ориентированный на конфиденциальность:

### Прозрачность открытого исходного кода для проверяемой конфиденциальности {#open-source-transparency-for-verifiable-privacy}

Хотя многие почтовые сервисы заявляют об открытом исходном коде, они часто держат свой бэкенд-код закрытым. Forward Email на 100% [с открытым исходным кодом](https://en.wikipedia.org/wiki/Open_source), включая как клиентский, так и бэкенд-код. Такая прозрачность позволяет проводить независимый аудит безопасности всех компонентов, гарантируя, что наши заявления о конфиденциальности могут быть проверены любым человеком.

### Отсутствие привязки к поставщику для конфиденциальности без компромиссов {#no-vendor-lock-in-for-privacy-without-compromise}

Многие почтовые провайдеры, ориентированные на конфиденциальность, требуют использования их фирменных приложений или сервисов. Forward Email работает с любым стандартным почтовым клиентом по протоколам [IMAP](https://en.wikipedia.org/wiki/Internet_Message_Access_Protocol), [POP3](https://en.wikipedia.org/wiki/Post_Office_Protocol) и [SMTP](https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol), предоставляя вам свободу выбора предпочитаемого почтового ПО без ущерба для конфиденциальности.

### Изолированные данные для настоящей изоляции {#sandboxed-data-for-true-isolation}

В отличие от сервисов, использующих общие базы данных, где все данные пользователей смешиваются, наш подход «песочницы» гарантирует полную изоляцию данных каждого пользователя. Это фундаментальное архитектурное отличие обеспечивает значительно более надежные гарантии конфиденциальности, чем то, что предлагают большинство почтовых сервисов.

### Переносимость и контроль данных {#data-portability-and-control}

Мы считаем, что ваши данные принадлежат вам, поэтому мы упрощаем экспорт ваших писем в стандартных форматах (MBOX, EML, SQLite) и действительно удаляем ваши данные, когда вы этого хотите. Такой уровень контроля редко встречается среди поставщиков услуг электронной почты, но он необходим для настоящей конфиденциальности.

## Технические проблемы пересылки электронной почты с приоритетом конфиденциальности {#the-technical-challenges-of-privacy-first-email-forwarding}

Создание почтового сервиса, ориентированного на конфиденциальность, сопряжено со значительными техническими трудностями. Вот некоторые из препятствий, которые мы преодолели:

### Управление памятью для обработки электронной почты без регистрации {#memory-management-for-no-logging-email-processing}

Обработка писем в памяти без дискового хранилища требует тщательного управления памятью для эффективной обработки больших объемов трафика электронной почты. Мы внедрили передовые методы оптимизации памяти, чтобы обеспечить надежную производительность без ущерба для нашей политики отсутствия хранилища, важнейшего компонента нашей стратегии защиты конфиденциальности.

### Обнаружение спама без анализа контента для фильтрации с сохранением конфиденциальности {#spam-detection-without-content-analysis-for-privacy-preserving-filtering}

Большинство систем обнаружения [спам](https://en.wikipedia.org/wiki/Email_spam) основаны на анализе содержимого электронных писем, что противоречит нашим принципам конфиденциальности. Мы разработали методы выявления спам-схем без чтения содержимого ваших писем, обеспечивая баланс между конфиденциальностью и удобством использования, сохраняя конфиденциальность ваших сообщений.

### Обеспечение совместимости с принципом «Конфиденциальность прежде всего» {#maintaining-compatibility-with-privacy-first-design}

Обеспечение совместимости со всеми почтовыми клиентами при внедрении расширенных функций конфиденциальности потребовало креативных инженерных решений. Наша команда неустанно работала над тем, чтобы сделать конфиденциальность бесшовной, поэтому вам не придется выбирать между удобством и безопасностью при защите ваших сообщений электронной почты.

## Рекомендации по обеспечению конфиденциальности для пользователей пересылки электронной почты {#privacy-best-practices-for-forward-email-users}

Чтобы максимально защититься от слежки за электронной почтой и обеспечить максимальную конфиденциальность при использовании пересылки электронной почты, мы рекомендуем следующие рекомендации:

1. **Используйте уникальные псевдонимы для разных сервисов**. Создайте отдельный псевдоним электронной почты для каждого сервиса, на который вы подписываетесь, чтобы предотвратить межсервисное отслеживание.
2. **Включите шифрование OpenPGP**. Для конфиденциальных сообщений используйте сквозное шифрование для обеспечения полной конфиденциальности.
3. **Регулярно меняйте псевдонимы электронной почты**. Периодически обновляйте псевдонимы для важных сервисов, чтобы минимизировать долгосрочный сбор данных.
4. **Используйте надежные уникальные пароли**. Защитите свою учетную запись для пересылки электронной почты надежным паролем, чтобы предотвратить несанкционированный доступ.
5. **Внедрите анонимизацию [IP-адрес](https://en.wikipedia.org/wiki/IP_address)**. Рассмотрите возможность использования [VPN](https://en.wikipedia.org/wiki/Virtual_private_network) в сочетании с пересылкой электронной почты для обеспечения полной анонимности.

## Заключение: Будущее пересылки личных сообщений электронной почты {#conclusion-the-future-of-private-email-forwarding}

В Forward Email мы считаем, что конфиденциальность — это не просто функция, это фундаментальное право. Наши технические реализации отражают это убеждение, предоставляя вам пересылку электронной почты, которая уважает вашу конфиденциальность на каждом уровне и защищает вас от слежки за электронной почтой и сбора метаданных.

По мере того, как мы продолжаем развивать и улучшать наш сервис, наша приверженность конфиденциальности остается непоколебимой. Мы постоянно исследуем новые методы шифрования, изучаем дополнительные средства защиты конфиденциальности и совершенствуем нашу кодовую базу, чтобы обеспечить максимально возможную безопасность электронной почты.

Выбирая Forward Email, вы не просто выбираете службу электронной почты — вы поддерживаете видение Интернета, где конфиденциальность является по умолчанию, а не исключением. Присоединяйтесь к нам в создании более приватного цифрового будущего, по одному письму за раз.

<!-- *Ключевые слова: пересылка личных сообщений, защита конфиденциальности электронной почты, защищенная служба электронной почты, электронная почта с открытым исходным кодом, квантово-безопасное шифрование, электронная почта OpenPGP, обработка электронной почты в памяти, служба электронной почты без регистрации, защита метаданных электронной почты, конфиденциальность заголовков электронной почты, сквозное шифрование электронной почты, электронная почта с приоритетом конфиденциальности, анонимная пересылка электронной почты, лучшие практики безопасности электронной почты, защита содержимого электронной почты, защита от фишинга, сканирование электронной почты на наличие вирусов, поставщик электронной почты, ориентированный на конфиденциальность, безопасные заголовки электронной почты, реализация конфиденциальности электронной почты, защита от слежки за электронной почтой, пересылка электронной почты без регистрации, предотвращение утечки метаданных электронной почты, методы конфиденциальности электронной почты, анонимизация IP-адресов для электронной почты, псевдонимы частной электронной почты, безопасность пересылки электронной почты, конфиденциальность электронной почты от рекламодателей, квантово-устойчивое шифрование электронной почты, конфиденциальность электронной почты без компромиссов, хранилище электронной почты SQLite, изолированное шифрование электронной почты, переносимость данных для электронной почты* -->
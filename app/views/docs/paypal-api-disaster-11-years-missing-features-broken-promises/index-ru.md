# 11-летняя катастрофа API PayPal: как мы создавали обходные пути, пока они игнорировали разработчиков {#paypals-11-year-api-disaster-how-we-built-workarounds-while-they-ignored-developers}

<img loading="lazy" src="/img/articles/pypl-disaster.webp" alt="" class="rounded-lg" />

<p class="lead mt-3">В Forward Email мы уже более десяти лет имеем дело со сломанными API PayPal. То, что начиналось как мелкие неприятности, превратилось в полную катастрофу, которая заставила нас разработать собственные обходные пути, заблокировать их фишинговые шаблоны и в конечном итоге остановить все платежи PayPal во время критической миграции аккаунта.</p>
<p class="lead mt-3">Это история 11 лет игнорирования PayPal основных потребностей разработчиков, в то время как мы пытались сделать все, чтобы заставить их платформу работать.</p>

## Содержание {#table-of-contents}

* [Недостающая часть: невозможность перечислить подписки](#the-missing-piece-no-way-to-list-subscriptions)
* [2014–2017: Возникновение проблемы](#2014-2017-the-problem-emerges)
* [2020: Мы даем им подробную обратную связь](#2020-we-give-them-extensive-feedback)
  * [Список отзывов из 27 пунктов](#the-27-item-feedback-list)
  * [Команды включились, обещания были даны](#teams-got-involved-promises-were-made)
  * [Результат? Ничего.](#the-result-nothing)
* [Исход руководителей: как PayPal утратил всю институциональную память](#the-executive-exodus-how-paypal-lost-all-institutional-memory)
* [2025: новое руководство, те же проблемы](#2025-new-leadership-same-problems)
  * [Новый генеральный директор вмешивается](#the-new-ceo-gets-involved)
  * [Ответ Мишель Гилл](#michelle-gills-response)
  * [Наш ответ: больше никаких встреч](#our-response-no-more-meetings)
  * [Ответ Марти Бродбека на чрезмерное проектирование](#marty-brodbecks-overengineering-response)
  * [Противоречие «Простой CRUD»](#the-simple-crud-contradiction)
  * [Разрыв становится очевидным](#the-disconnect-becomes-clear)
* [Годы сообщений об ошибках, которые они игнорировали](#years-of-bug-reports-they-ignored)
  * [2016: Первые жалобы на UI/UX](#2016-early-uiux-complaints)
  * [2021: Отчет об ошибках в деловой электронной почте](#2021-business-email-bug-report)
  * [2021: Предложения по улучшению пользовательского интерфейса](#2021-ui-improvement-suggestions)
  * [2021: Ошибки в среде «песочницы»](#2021-sandbox-environment-failures)
  * [2021: Система отчётов полностью сломана](#2021-reports-system-completely-broken)
  * [2022: функция Core API снова отсутствует](#2022-core-api-feature-missing-again)
* [Кошмар для разработчиков](#the-developer-experience-nightmare)
  * [Неработающий пользовательский интерфейс](#broken-user-interface)
  * [Проблемы SDK](#sdk-problems)
  * [Нарушения политики безопасности контента](#content-security-policy-violations)
  * [Хаос документации](#documentation-chaos)
  * [Уязвимости безопасности](#security-vulnerabilities)
  * [Авария управления сеансом](#session-management-disaster)
* [Июль 2025 г.: последняя капля](#july-2025-the-final-straw)
* [Почему мы не можем просто отказаться от PayPal](#why-we-cant-just-drop-paypal)
* [Обходной путь сообщества](#the-community-workaround)
* [Блокировка шаблонов PayPal из-за фишинга](#blocking-paypal-templates-due-to-phishing)
  * [Реальная проблема: шаблоны PayPal выглядят как мошенничество](#the-real-problem-paypals-templates-look-like-scams)
  * [Наша реализация](#our-implementation)
  * [Почему нам пришлось заблокировать PayPal](#why-we-had-to-block-paypal)
  * [Масштаб проблемы](#the-scale-of-the-problem)
  * [Ирония](#the-irony)
  * [Реальные последствия: новые виды мошенничества PayPal](#real-world-impact-novel-paypal-scams)
* [Обратный процесс KYC PayPal](#paypals-backwards-kyc-process)
  * [Как это должно работать](#how-it-should-work)
  * [Как на самом деле работает PayPal](#how-paypal-actually-works)
  * [Реальное влияние](#the-real-world-impact)
  * [Катастрофа с миграцией аккаунтов в июле 2025 года](#the-july-2025-account-migration-disaster)
  * [Почему это важно](#why-this-matters)
* [Как все остальные платежные системы делают это правильно](#how-every-other-payment-processor-does-it-right)
  * [Полосатый](#stripe)
  * [Весло](#paddle)
  * [Coinbase Commerce](#coinbase-commerce)
  * [Квадрат](#square)
  * [Отраслевой стандарт](#the-industry-standard)
  * [Что предоставляют другие процессоры по сравнению с PayPal](#what-other-processors-provide-vs-paypal)
* [Систематическое сокрытие информации PayPal: заглушение 6 миллионов голосов](#paypals-systematic-cover-up-silencing-6-million-voices)
  * [Великое стирание](#the-great-erasure)
  * [Спасение третьей стороны](#the-third-party-rescue)
* [11-летняя катастрофа с клопами-ловителями: $1899 и всё больше](#the-11-year-capture-bug-disaster-1899-and-counting)
  * [Убыток от пересылки электронных писем в размере 1899 долларов США](#forward-emails-1899-loss)
  * [Первоначальный отчет 2013 года: более 11 лет халатности](#the-2013-original-report-11-years-of-negligence)
  * [Допуск 2016 года: PayPal ломает свой собственный SDK](#the-2016-admission-paypal-breaks-their-own-sdk)
  * [Эскалация 2024 года: все еще не завершена](#the-2024-escalation-still-broken)
  * [Катастрофа надежности Webhook](#the-webhook-reliability-disaster)
  * [Модель систематической халатности](#the-pattern-of-systematic-negligence)
  * [Недокументированное требование](#the-undocumented-requirement)
* [Более общая схема обмана PayPal](#paypals-broader-pattern-of-deception)
  * [Действия Департамента финансовых услуг Нью-Йорка](#the-new-york-department-of-financial-services-action)
  * [Судебный процесс по делу о меде: переписывание партнерских ссылок](#the-honey-lawsuit-rewriting-affiliate-links)
  * [Цена халатности PayPal](#the-cost-of-paypals-negligence)
  * [Ложь о документации](#the-documentation-lie)
* [Что это значит для разработчиков](#what-this-means-for-developers)

## Недостающая часть: невозможно перечислить подписки {#the-missing-piece-no-way-to-list-subscriptions}

Вот что нас поражает: PayPal предлагает подписную оплату с 2014 года, но они никогда не предоставляли продавцам возможности размещать собственные подписки.

Подумайте об этом на секунду. Вы можете создавать подписки, вы можете их отменять, если у вас есть идентификатор, но вы не можете получить список всех активных подписок для вашего аккаунта. Это как иметь базу данных без оператора SELECT.

Это нам необходимо для основных бизнес-операций:

* Поддержка клиентов (когда кто-то пишет письмо с вопросом о подписке)
* Финансовая отчетность и сверка
* Автоматизированное управление выставлением счетов
* Соблюдение и аудит

А PayPal? Они просто... его так и не построили.

## 2014–2017: Возникновение проблемы {#2014-2017-the-problem-emerges}

Проблема со списком подписок впервые возникла на форумах сообщества PayPal еще в 2017 году. Разработчики задавали очевидный вопрос: «Как мне получить список всех моих подписок?»

Ответ PayPal? Сверчки.

Члены сообщества начали расстраиваться:

> "Очень странное упущение, если торговец не может перечислить все активные соглашения. Если идентификатор соглашения утерян, это означает, что отменить или приостановить соглашение может только пользователь." - leafspider

> "+1. Прошло почти 3 года." - laudukang (имеется в виду, что проблема существовала с \~2014)

[оригинальный пост сообщества](https://web.archive.org/web/20201019142512/https://www.paypal-community.com/t5/REST-API-SDK/List-all-subscriptions/td-p/1147066) от 2017 года показывает, что разработчики умоляют о добавлении этой базовой функции. В ответ PayPal архивировал репозиторий, где пользователи сообщали об этой проблеме.

## 2020: Мы даем им подробную обратную связь {#2020-we-give-them-extensive-feedback}

В октябре 2020 года PayPal обратилась к нам за официальной сессией обратной связи. Это был не какой-то случайный разговор — они организовали 45-минутный звонок Microsoft Teams с 8 руководителями PayPal, включая Шри Шивананду (технический директор), Эдвина Аоки, Джима Магатса, Джона Кунце и других.

### Список отзывов из 27 пунктов {#the-27-item-feedback-list}

Мы пришли подготовленными. После 6 часов попыток интеграции с их API мы собрали 27 конкретных проблем. Марк Стюарт из команды PayPal Checkout сказал:

> Привет, Ник, спасибо, что поделился сегодня со всеми! Я думаю, это станет катализатором для получения дополнительной поддержки и инвестиций для нашей команды, чтобы пойти и исправить эти вещи. Было трудно получить содержательные отзывы, такие как те, что вы нам оставили до сих пор.

Обратная связь не была теоретической — она исходила из реальных попыток интеграции:

1. **Генерация токена доступа не работает**:

> Генерация токена доступа не работает. Также должно быть больше, чем просто примеры cURL.

2. **Отсутствие веб-интерфейса для создания подписки**:

> Как, черт возьми, можно создавать подписки, не используя cURL? Похоже, что веб-интерфейса для этого нет (как у Stripe)

Марк Стюарт обнаружил, что проблема с токенами доступа вызывает особую обеспокоенность:

> Обычно мы не слышим о проблемах, связанных с генерацией токенов доступа.

### Команды включились, обещания были даны {#teams-got-involved-promises-were-made}

По мере того, как мы обнаруживали все больше проблем, PayPal продолжала добавлять все больше команд к обсуждению. Даршан Раджу из команды UI управления подписками присоединился и сказал:

> Признайте пробел. Мы отследим и решим этот вопрос. Еще раз спасибо за ваш отзыв!

Сессия была описана как попытка:

> откровенный рассказ о вашем опыте

к:

> сделать PayPal тем, чем он должен быть для разработчиков.

### Результат? Ничего. {#the-result-nothing}

Несмотря на формальную сессию обратной связи, обширный список из 27 пунктов, участие нескольких команд и обещания:

> трек и адрес

проблемы, абсолютно ничего не было исправлено.

## Исход руководителей: как PayPal утратил всю институциональную память {#the-executive-exodus-how-paypal-lost-all-institutional-memory}

Вот где становится действительно интересно. Каждый, кто получил наши отзывы за 2020 год, покинул PayPal:

**Изменения в руководстве:**

* [Дэн Шульман (генеральный директор в течение 9 лет) → Алекс Крисс](https://www.fastcompany.com/90938418/paypal-ceo-alex-chriss-dan-schulman-what-to-know/) (сентябрь 2023 г.)
* [Шри Шивананда (технический директор, организовавший обратную связь) → JPMorgan Chase](https://www.pymnts.com/personnel/2024/jpmorgan-names-paypal-vet-shivananda-as-new-tech-chief/) (январь 2024 г.)

**Технические руководители, которые давали обещания, а затем ушли:**

* **Марк Стюарт** (обещал, что отзыв станет «катализатором») → [Сейчас в Ripple](https://www.linkedin.com/in/markstuartsf)
* **Джим Магатс** (18 лет работы в PayPal) → [Генеральный директор MX](https://www.cnbc.com/2022/07/28/paypal-veteran-jim-magats-is-named-ceo-of-mx-the-startup-that-connects-banks-and-fintech-players.html) (2022)
* **Джон Кунце** (вице-президент по глобальным потребительским товарам) → [Ушедший на пенсию](https://www.linkedin.com/in/john-kunze-5724a86) (2023)
* **Эдвин Аоки** (один из последних оставшихся) → [Только что ушёл на Nasdaq](https://www.linkedin.com/posts/edwinaoki_apparently-i-just-cant-stay-awaythe-day-activity-7289388518487793664-j8OZ) (январь 2025)

PayPal превратился в вращающуюся дверь, где руководители собирают отзывы разработчиков, дают обещания, а затем уходят в более сильные компании, такие как JPMorgan, Ripple и другие финтех-компании.

Это объясняет, почему ответ на проблему на GitHub за 2025 год, похоже, совершенно не связан с нашими отзывами за 2020 год — буквально все, кто получил этот отзыв, покинули PayPal.

## 2025: Новое руководство, те же проблемы {#2025-new-leadership-same-problems}

Перенесемся в 2025 год, и мы увидим ту же самую картину. После многих лет отсутствия прогресса новое руководство PayPal снова протягивает руку помощи.

### Новый генеральный директор вмешивается {#the-new-ceo-gets-involved}

30 июня 2025 года мы обратились напрямую к новому генеральному директору PayPal Алексу Криссу. Его ответ был кратким:

> Привет, Ник – Спасибо, что связались с нами и оставили отзыв. Мишель (копия) находится на месте со своей командой, чтобы взаимодействовать и работать над этим с вами. Спасибо -A

### Ответ Мишель Гилл {#michelle-gills-response}

Мишель Гилл, исполнительный вице-президент и генеральный менеджер по малому бизнесу и финансовым услугам, ответила:

> Большое спасибо, Ник, перевод Алекса в скрытую копию. Мы изучаем это с момента вашего предыдущего поста. Мы позвоним вам до конца недели. Не могли бы вы прислать мне ваши контактные данные, чтобы кто-нибудь из моих коллег мог связаться с вами. Мишель

### Наш ответ: больше никаких встреч {#our-response-no-more-meetings}

Мы отказались от еще одной встречи, объяснив свое разочарование следующим:

> Спасибо. Однако я не думаю, что звонок что-то даст. Вот почему... Я звонил в прошлом, и это ни к чему не привело. Я потратил 2+ часа своего времени на разговоры со всей командой и руководством, и ничего не было сделано... Тонны писем туда-сюда. Абсолютно ничего не сделано. Обратная связь никуда не делась. Я пытался годами, чтобы меня выслушали, но потом все шло в никуда.

### Ответ Марти Бродбека на чрезмерное проектирование {#marty-brodbecks-overengineering-response}

Затем ко мне обратился Марти Бродбек, возглавляющий отдел потребительских технологий в PayPal:

> Привет, Ник, это Марти Бродбек. Я возглавляю всю потребительскую инженерию здесь, в PayPal, и занимаюсь разработкой API для компании. Можем ли мы с вами связаться по поводу проблемы, с которой вы столкнулись, и как мы можем вам помочь.

Когда мы объяснили ему простую необходимость в конечной точке листинга подписки, его ответ выявил точную проблему:

> Спасибо, Ник, мы находимся в процессе создания единого API подписки с полным SDK (поддерживает полную обработку ошибок, отслеживание подписки на основе событий, надежное время безотказной работы), где выставление счетов также разделено на отдельный API, к которому могут обращаться продавцы, вместо того чтобы организовывать работу на нескольких конечных точках для получения единого ответа.

Это совершенно неправильный подход. Нам не нужны месяцы сложной архитектуры. Нам нужна одна простая конечная точка REST, которая перечисляет подписки — то, что должно было существовать с 2014 года.

```http
GET /v1/billing/subscriptions
Authorization: Bearer {access_token}
```

### Противоречие «простого CRUD» {#the-simple-crud-contradiction}

Когда мы указали, что это базовая функциональность CRUD, которая должна была существовать с 2014 года, ответ Марти был показательным:

> Простые операции Crud являются частью основного API, мой друг, так что это не займет месяцы разработки

Пакет разработчика программного обеспечения PayPal TypeScript, который в настоящее время поддерживает только три конечные точки после нескольких месяцев разработки, а также его историческая хронология наглядно демонстрируют, что для завершения таких проектов требуется больше, чем несколько месяцев.

Этот ответ показывает, что он не понимает свой собственный API. Если «простые операции CRUD являются частью основного API», то где находится конечная точка листинга подписки? Мы ответили:

> Если «простые операции CRUD являются частью основного API», то где находится конечная точка листинга подписки? Разработчики просили об этой «простой операции CRUD» с 2014 года. Прошло 11 лет. У каждого другого процессора платежей была эта базовая функциональность с самого начала.

### Разрыв соединения становится очевидным {#the-disconnect-becomes-clear}

Обмен мнениями с Алексом Криссом, Мишель Гилл и Марти Бродбеком в 2025 году демонстрирует ту же организационную дисфункцию:

1. **Новое руководство не знает о предыдущих сессиях обратной связи**
2. **Они предлагают те же самые переусложненные решения**
3. **Они не понимают ограничений собственного API**
4. **Они хотят больше встреч вместо того, чтобы просто решить проблему**

Эта тенденция объясняет, почему команды PayPal в 2025 году, похоже, совершенно не следят за обширной обратной связью, предоставленной в 2020 году: люди, которые получали эту обратную связь, ушли, а новое руководство повторяет те же ошибки.

## Годы сообщений об ошибках, которые они игнорировали {#years-of-bug-reports-they-ignored}

Мы не просто жаловались на отсутствие функций. Мы активно сообщали об ошибках и пытались помочь их улучшить. Вот полная хронология проблем, которые мы задокументировали:

### 2016: Первые жалобы на UI/UX {#2016-early-uiux-complaints}

Еще в 2016 году мы публично обращались к руководству PayPal, включая Дэна Шульмана, по поводу проблем с интерфейсом и удобством использования. Это было 9 лет назад, и те же проблемы UI/UX сохраняются и сегодня.

### 2021: Отчет об ошибках в деловой электронной почте {#2021-business-email-bug-report}

В марте 2021 года мы сообщили, что корпоративная почтовая система PayPal отправляла некорректные уведомления об отмене. В шаблоне письма переменные отображались неправильно, что приводило к появлению запутанных сообщений для клиентов.

Марк Стюарт признал наличие проблемы:

> Спасибо, Ник! Переходим к BCC. @Prasy, ваша команда несет ответственность за это электронное письмо или знаете, кто? Текст "Niftylettuce, LLC, мы больше не будем выставлять вам счет" заставляет меня думать, что произошла путаница в том, кому оно адресовано и в содержании электронного письма.

**Результат**: Они действительно исправили это! Марк Стюарт подтвердил:

> Только что услышал от команды уведомлений, что шаблон электронного письма был исправлен и развернут. Спасибо, что вы обратились, чтобы сообщить об этом. Спасибо!

Это показывает, что они МОГУТ исправить ситуацию, когда захотят, — просто в большинстве случаев они предпочитают этого не делать.

### 2021: Предложения по улучшению пользовательского интерфейса {#2021-ui-improvement-suggestions}

В феврале 2021 года мы предоставили подробный отзыв об интерфейсе панели управления, в частности о разделе «Недавние действия PayPal»:

> Я думаю, что панель управления на paypal.com, в частности "PayPal Recent Activity", нуждается в улучшении. Я не думаю, что вам следует показывать строки статуса "Создано" для повторяющегося платежа $0 - это просто добавляет кучу дополнительных строк, и вы не можете легко увидеть с первого взгляда, сколько дохода генерируется за день/последние несколько дней.

Марк Стюарт переслал его команде по потребительским товарам:

> Спасибо! Я не уверен, какая команда отвечает за Activity, но я переслал это руководителю отдела потребительских товаров, чтобы найти нужную команду. Повторяющийся платеж в размере 0,00 $ кажется ошибкой. Вероятно, его следует отфильтровать.

**Результат**: Никогда не исправлено. Пользовательский интерфейс все еще показывает эти бесполезные записи $0.

### 2021: Ошибки среды «песочницы» {#2021-sandbox-environment-failures}

В ноябре 2021 года мы сообщили о критических проблемах в тестовой среде PayPal:

* Секретные ключи API песочницы были случайно изменены и отключены
* Все тестовые учетные записи песочницы были удалены без уведомления
* Сообщения об ошибках при попытке просмотра данных учетной записи песочницы
* Периодические сбои загрузки

> По какой-то причине мой секретный ключ API sandbox был изменен и он был Disabled. Также все мои старые тестовые аккаунты Sandbox были удалены.

> Иногда они загружаются, а иногда нет. Это безумно раздражает.

**Результат**: Нет ответа, нет исправления. Разработчики по-прежнему сталкиваются с проблемами надежности песочницы.

### 2021: Система отчетов полностью сломана {#2021-reports-system-completely-broken}

В мае 2021 года мы сообщили, что система загрузки отчетов о транзакциях PayPal полностью вышла из строя:

> Похоже, что отчеты о загрузках не работают сейчас и не работали весь день. Также, вероятно, следует получить уведомление по электронной почте, если это не удастся.

Мы также указали на катастрофу в управлении сеансами:

> Также, если вы неактивны, находясь в PayPal в течение 5 минут, вы выходите из системы. Поэтому, когда вы снова обновляете кнопку рядом с отчетом, статус которого хотите проверить (после того, как вы ждали вечность), это просто утомительно — снова входить в систему.

Марк Стюарт признал наличие проблемы с тайм-аутом сеанса:

> Я помню, что раньше вы сообщали, что ваша сессия часто истекала и нарушала процесс разработки, когда вы переключались между IDE и developer.paypal.com или панелью управления торговца, а затем вы возвращались и снова оказывались вне системы.

**Результат**: Тайм-ауты сеанса по-прежнему составляют 60 секунд. Система отчетов по-прежнему регулярно дает сбои.

### 2022: Основная функция API отсутствует (снова) {#2022-core-api-feature-missing-again}

В январе 2022 года мы снова подняли вопрос о листинге подписки, на этот раз с еще более подробными сведениями о том, в чем заключалась ошибка в их документации:

> Нет GET, в котором перечислены все подписки (ранее называвшиеся соглашениями о выставлении счетов)

Мы обнаружили, что их официальная документация была совершенно неточной:

> Документация API также полностью неточна. Мы думали, что сможем обойти это, загрузив жестко закодированный список идентификаторов подписок. Но это даже не работает!

> Из официальных документов здесь... Там говорится, что вы можете сделать это... Но вот в чем загвоздка: вообще нигде нет поля «Идентификатор подписки», которое можно было бы проверить.

Кристина Монти из PayPal ответила:

> Приносим извинения за досаду, вызванную неправильными шагами, мы исправим это на этой неделе.

Шри Шивананда (технический директор) поблагодарил нас:

> Спасибо за вашу постоянную помощь в улучшении нашей работы. Очень признателен.

**Результат**: Документация так и не была исправлена. Конечная точка листинга подписки так и не была создана.

## Кошмар для разработчиков {#the-developer-experience-nightmare}

Работа с API PayPal — это как вернуться на 10 лет назад. Вот технические проблемы, которые мы задокументировали:

### Неисправный пользовательский интерфейс {#broken-user-interface}

Панель разработчика PayPal — это катастрофа. Вот с чем мы сталкиваемся ежедневно:

<figure>
<figcaption><div class="alert alert-danger small text-center">
Пользовательский интерфейс PayPal настолько сломан, что вы даже не можете отклонить уведомления
</div></figcaption>
<video class="lazyframe-bordered" loading="lazy" controls>
<source src="/img/articles/pypl-notifications.mp4" type="video/mp4">
Ваш браузер не поддерживает тег video.
</video>
</figure>

<figure>
<figcaption><div class="alert alert-danger small text-center">
Панель разработчика буквально заставляет вас перетаскивать ползунок, а затем выводит вас из системы через 60 секунд
</div></figcaption>
<video class="lazyframe-bordered" loading="lazy" controls>
<source src="/img/articles/pypl-kapture-1.mp4" type="video/mp4">
Ваш браузер не поддерживает тег video.
</video>
</figure>

<figure>
<figcaption><div class="alert alert-danger small text-center">
Еще больше неполадок в интерфейсе разработчика PayPal, демонстрирующих неработающие рабочие процессы
</div></figcaption>
<video class="lazyframe-bordered" loading="lazy" controls>
<source src="/img/articles/pypl-kapture-2.mp4" type="video/mp4">
Ваш браузер не поддерживает тег video.
</video>
</figure>

<figure>
<figcaption><div class="alert alert-danger small text-center">
Интерфейс управления подпиской — интерфейс настолько плох, что нам пришлось полагаться на код для генерации продуктов и планов подписки
</div></figcaption>
<img loading="lazy" src="/img/articles/pypl-subscriptions.png" alt="" class="rounded-lg" />
</figure>

<figure>
<figcaption><div class="alert alert-danger small text-center">
Вид сломанного интерфейса подписки с отсутствующей функциональностью (вы не можете легко создавать продукты/планы/подписки &ndash; и, похоже, вообще нет способа удалить продукты или планы после их создания в пользовательском интерфейсе)
</div></figcaption>
<img loading="lazy" src="/img/articles/pypl-subscriptions-2.png" alt="" class="rounded-lg" />
</figure>

<figure>
<figcaption><div class="alert alert-danger small text-center">
Типичные сообщения об ошибках PayPal — загадочные и бесполезные
</div></figcaption>
<img loading="lazy" src="/img/articles/pypl-errors.png" alt="" class="rounded-lg" />
</figure>

### Проблемы SDK {#sdk-problems}

* Невозможно обрабатывать как единовременные платежи, так и подписки без сложных обходных путей, включающих замену и повторную визуализацию кнопок при повторной загрузке SDK с тегами скриптов
* JavaScript SDK нарушает основные соглашения (имена классов в нижнем регистре, нет проверки экземпляров)
* Сообщения об ошибках не указывают, какие поля отсутствуют
* Несогласованные типы данных (требуются строковые суммы вместо чисел)

### Нарушения политики безопасности контента {#content-security-policy-violations}

Их SDK требует unsafe-inline и unsafe-eval в вашем CSP, **заставляя вас поставить под угрозу безопасность вашего сайта**.

### Хаос документации {#documentation-chaos}

Сам Марк Стюарт признался:

> Согласен, что существует абсурдное количество устаревших и новых API. Действительно трудно найти то, что искать (даже для нас, кто здесь работает).

### Уязвимости безопасности {#security-vulnerabilities}

**Реализация 2FA в PayPal отсталая**. Даже при включенных приложениях TOTP они принудительно проверяют по SMS, что делает аккаунты уязвимыми для атак с подменой SIM-карты. Если у вас включен TOTP, он должен использовать только его. Запасным вариантом должна быть электронная почта, а не SMS.

### Авария управления сеансом {#session-management-disaster}

**Их панель разработчика выводит вас из системы после 60 секунд бездействия**. Попробуйте сделать что-нибудь продуктивное, и вы постоянно будете проходить: вход → капча → 2FA → выход → повтор. Используете VPN? Удачи.

## Июль 2025 г.: Последняя капля {#july-2025-the-final-straw}

После 11 лет одних и тех же проблем переломный момент наступил во время планового переноса учётной записи. Нам нужно было перейти на новый счёт PayPal, соответствующий названию нашей компании «Forward Email LLC», для более точной бухгалтерской отчётности.

То, что должно было быть простым, превратилось в полную катастрофу:

* Первоначальное тестирование показало, что всё работает корректно.
* Спустя несколько часов PayPal внезапно заблокировал все платежи по подписке без предупреждения.
* Клиенты не могли платить, что создавало путаницу и создавало дополнительную нагрузку на службу поддержки.
* Служба поддержки PayPal давала противоречивые ответы, утверждая, что аккаунты были верифицированы.
* Мы были вынуждены полностью прекратить платежи через PayPal.

<figure>
<figcaption><div class="alert alert-danger small text-center">
Ошибка, которую видели клиенты при попытке оплаты — никаких объяснений, никаких журналов, ничего.
</div></figcaption>
<img loading="lazy" src="/img/articles/pypl-something-went-wrong.png" alt="" class="rounded-lg" />
</figure>

<figure>
<figcaption><div class="alert alert-danger small text-center">
Служба поддержки PayPal утверждает, что всё в порядке, хотя платежи полностью прекратились. В последнем сообщении говорится, что они «восстановили некоторые функции», но по-прежнему просят дополнительную неуточненную информацию — классический пример поддержки PayPal.
</div></figcaption>
<img loading="lazy" src="/img/articles/pypl-help-center-1.png" alt="" class="rounded-lg" />
<img loading="lazy" src="/img/articles/pypl-help-center-2.png" alt="" class="rounded-lg" />
<img loading="lazy" src="/img/articles/pypl-help-center-3.png" alt="" class="rounded-lg" />
<img loading="lazy" src="/img/articles/pypl-help-center-4.png" alt="" class="rounded-lg" />
<img loading="lazy" src="/img/articles/pypl-help-center-5.png" alt="" class="rounded-lg" />
<img loading="lazy" src="/img/articles/pypl-help-center-6.png" alt="" class="rounded-lg" />
</figure>

<figure>
<figcaption><div class="alert alert-danger small text-center">
Процесс подтверждения личности, который якобы ничего не «исправил»
</div></figcaption>
<img loading="lazy" src="/img/articles/pypl-take-care-1.png" alt="" class="rounded-lg" />
<img loading="lazy" src="/img/articles/pypl-take-care-2.png" alt="" class="rounded-lg" />
<img loading="lazy" src="/img/articles/pypl-take-care-3.png" alt="" class="rounded-lg" />
<img loading="lazy" src="/img/articles/pypl-take-care-4.png" alt="" class="rounded-lg" />
<img loading="lazy" src="/img/articles/pypl-take-care-5.png" alt="" class="rounded-lg" />
<img loading="lazy" src="/img/articles/pypl-take-care-6.png" alt="" class="rounded-lg" />
<img loading="lazy" src="/img/articles/pypl-take-care-7.png" alt="" class="rounded-lg" />
</figure>

<figure>
<figcaption><div class="alert alert-danger small text-center">
Расплывчатое сообщение, и решение так и не найдено. Никакой информации, уведомлений или каких-либо дополнительных сведений о том, какая информация требуется. Служба поддержки молчит.
</div></figcaption>
<img loading="lazy" src="/img/articles/pypl-restored.png" alt="" class="rounded-lg" />
</figure>

## Почему мы не можем просто отказаться от PayPal {#why-we-cant-just-drop-paypal}

Несмотря на все эти проблемы, мы не можем полностью отказаться от PayPal, поскольку для некоторых клиентов PayPal — единственный способ оплаты. Как написал один из клиентов на нашей [страница статуса](https://github.com/forwardemail/status.forwardemail.net/issues/1658#issuecomment-3026530515):

> PayPal — мой единственный вариант оплаты

**Мы вынуждены поддерживать неисправную платформу, поскольку PayPal создал монополию на платежи для определенных пользователей.**

## Обходной путь сообщества {#the-community-workaround}

Поскольку PayPal не предоставляет базовую функциональность листинга подписок, сообщество разработчиков разработало обходные пути. Мы создали скрипт, который помогает управлять подписками PayPal: [set-active-pypl-subscription-ids.js](https://github.com/forwardemail/forwardemail.net/blob/master/scripts/set-active-pypl-subscription-ids.js)

Этот скрипт ссылается на [суть сообщества](https://gist.github.com/titanism/955f0c21d53e8c98068c549fb79e75d4), где разработчики делятся решениями. Пользователи, на самом деле, [поблагодарив нас](https://gist.github.com/titanism/955f0c21d53e8c98068c549fb79e75d4?permalink_comment_id=5045775#gistcomment-5045775) предоставляют то, что PayPal должен был создать много лет назад.

## Блокировка шаблонов PayPal из-за фишинга {#blocking-paypal-templates-due-to-phishing}

Проблемы выходят за рамки API. Шаблоны электронных писем PayPal настолько плохо проработаны, что нам пришлось внедрить специальную фильтрацию в наш почтовый сервис, поскольку они неотличимы от попыток фишинга.

### Реальная проблема: шаблоны PayPal выглядят как мошенничество {#the-real-problem-paypals-templates-look-like-scams}

Мы регулярно получаем сообщения об электронных письмах от PayPal, которые выглядят точь-в-точь как попытки фишинга. Вот реальный пример из наших сообщений о злоупотреблениях:

**Тема:** `[Sandbox] TEST - New invoice from PaypalBilling434567 sandbox #A4D369E8-0001`

Это письмо было перенаправлено на адрес `abuse@microsoft.com`, поскольку оно, по всей видимости, было попыткой фишинга. В чём проблема? На самом деле письмо пришло из изолированной среды PayPal, но их шаблон настолько неудачен, что срабатывает система обнаружения фишинга.

### Наша реализация {#our-implementation}

Вы можете увидеть нашу специфическую для PayPal фильтрацию, реализованную в нашей [код фильтрации электронной почты](https://github.com/forwardemail/forwardemail.net/blob/3b45c70391b5b572b2568749d71be3f7198cd995/helpers/is-arbitrary.js#L151-L172):

```javascript
// check for paypal scam (very strict until PayPal resolves phishing on their end)
// (seems to only come from "outlook.com" and "paypal.com" hosts)
//
// X-Email-Type-Id = RT000238
// PPC001017
// RT000542 = gift message hack
// RT002947 = paypal invoice spam
// <https://www.bleepingcomputer.com/news/security/beware-paypal-new-address-fraud/>
//
if (
  session.originalFromAddressRootDomain === 'paypal.com' &&
  headers.hasHeader('x-email-type-id') &&
  ['PPC001017', 'RT000238', 'RT000542', 'RT002947'].includes(
    headers.getFirst('x-email-type-id')
  )
) {
  const err = new SMTPError(
    'Due to ongoing PayPal invoice spam, you must manually send an invoice link'
  );
  err.isCodeBug = true; // alert admins for inspection
  throw err;
}
```

### Почему нам пришлось заблокировать PayPal {#why-we-had-to-block-paypal}

Мы внедрили это решение, поскольку PayPal отказался устранять серьёзные проблемы со спамом, фишингом и мошенничеством, несмотря на наши неоднократные обращения в их отделы по борьбе с нарушениями. Мы блокируем следующие типы электронных писем:

* **RT000238** — Подозрительные уведомления о счетах
* **PPC001017** — Проблемные подтверждения платежей
* **RT000542** — Попытки взлома сообщений о подарках

### Масштаб проблемы {#the-scale-of-the-problem}

Наши журналы фильтрации спама показывают огромный объём спама, связанного со счетами PayPal, который мы обрабатываем ежедневно. Примеры заблокированных тем:

* «Счёт от отдела по выставлению счётов PayPal: эта сумма будет автоматически списана с вашего счёта. Пожалуйста, немедленно свяжитесь с нами по телефону \[ТЕЛЕФОН]»
* «Счёт от \[НАЗВАНИЕ КОМПАНИИ] (\[ИДЕНТИФИКАТОР ЗАКАЗА])»
* Различные варианты с разными номерами телефонов и поддельными идентификаторами заказов

Эти письма часто приходят с хостов `outlook.com`, но, судя по всему, отправляются из легитимных систем PayPal, что делает их особенно опасными. Эти письма проходят аутентификацию SPF, DKIM и DMARC, поскольку отправляются через реальную инфраструктуру PayPal.

Наши технические журналы показывают, что эти спам-письма содержат законные заголовки PayPal:

* `X-Email-Type-Id: RT000238` (тот же идентификатор, который мы блокируем)
* `From: "service@paypal.com" <service@paypal.com>`
* Действительные подписи DKIM от `paypal.com`
* Корректные записи SPF, указывающие почтовые серверы PayPal

Это создает невозможную ситуацию: как легитимные электронные письма PayPal, так и спам имеют идентичные технические характеристики.

### Ирония {#the-irony}

PayPal, компания, которая должна возглавлять борьбу с финансовым мошенничеством, использует настолько неудачные шаблоны электронных писем, что они вызывают срабатывание антифишинговых систем. Мы вынуждены блокировать легитимные письма от PayPal, поскольку их невозможно отличить от мошеннических.

Это зафиксировано в исследовании безопасности: [Остерегайтесь мошенничества с новыми адресами PayPal](https://www.bleepingcomputer.com/news/security/beware-paypal-new-address-feature-abused-to-send-phishing-emails/), показывающем, как собственные системы PayPal используются для мошенничества.

### Реальное влияние: новые виды мошенничества PayPal {#real-world-impact-novel-paypal-scams}

Проблема выходит за рамки простого дизайна шаблона. Система выставления счетов PayPal настолько легко уязвима, что мошенники регулярно используют её для отправки мошеннических счетов, выглядящих как настоящие. Исследователь по безопасности Гэвин Андерегг задокументировал [Новая афера PayPal](https://anderegg.ca/2023/02/01/a-novel-paypal-scam), когда мошенники отправляют настоящие счета PayPal, прошедшие все проверки подлинности:

> «Проверив источник, я понял, что письмо действительно пришло от PayPal (проверено на SPF, DKIM и DMARC). Кнопка также вела на URL-адрес, который выглядел как настоящий PayPal... Мне потребовалась секунда, чтобы понять, что это настоящее письмо. Мне только что прислали случайный «счёт» от мошенника».

<figure>
<figcaption><div class="alert alert-danger small text-center">
Скриншот, на котором показано множество мошеннических счетов PayPal, заполонивших почтовый ящик. Все они выглядят законными, поскольку на самом деле исходят из систем PayPal.
</div></figcaption>
<img loading="lazy" src="/img/articles/pypl-paypal-scam.png" alt="" class="rounded-lg" />
</figure>

Исследователь отметил:

> «Кажется, PayPal стоит рассмотреть возможность блокировки этой функции из соображений удобства. Я сразу предположил, что это какая-то форма мошенничества, и меня интересовали только технические детали. Похоже, это слишком просто реализовать, и я боюсь, что другие могут на это поддаться».

Это прекрасно иллюстрирует проблему: собственные законные системы PayPal настолько плохо спроектированы, что они создают возможности для мошенничества, одновременно делая законные коммуникации подозрительными.

Что еще хуже, это повлияло на качество наших поставок в Yahoo, что привело к жалобам клиентов и многочасовому тщательному тестированию и проверке шаблонов.

## Обратная процедура KYC PayPal {#paypals-backwards-kyc-process}

Один из самых неприятных аспектов платформы PayPal — это их неэффективный подход к соблюдению требований и процедурам «Знай своего клиента» (KYC). В отличие от других платёжных систем, PayPal позволяет разработчикам интегрировать свои API и начинать сбор платежей в эксплуатацию до завершения надлежащей верификации.

### Как это должно работать {#how-it-should-work}

Каждый законный платежный оператор следует этой логической последовательности:

1. **Сначала пройдите верификацию KYC**
2. **Одобрите аккаунт продавца**
3. **Предоставьте доступ к API для работы**
4. **Разрешите сбор платежей**

Это защищает как обработчика платежей, так и продавца, гарантируя соблюдение требований до того, как деньги перейдут из рук в руки.

### Как на самом деле работает PayPal {#how-paypal-actually-works}

Процесс PayPal полностью противоположен:

1. **Немедленно предоставить доступ к API**
2. **Разрешить сбор платежей на несколько часов или дней**
3. **Внезапно заблокировать платежи без уведомления**
4. **Требовать документы KYC после того, как клиенты уже столкнулись с проблемой**
5. **Не уведомлять продавца**
6. **Дать клиентам возможность обнаружить проблему и сообщить о ней**

### Реальное влияние {#the-real-world-impact}

Этот обратный процесс создает катастрофы для бизнеса:

* **Клиенты не могут совершать покупки** в периоды пиковых продаж
* **Отсутствие предварительного предупреждения** о необходимости верификации
* **Отсутствие уведомлений по электронной почте** при блокировке платежей
* **Торговцы узнают о проблемах от растерянных клиентов**
* **Потеря дохода** в критические для бизнеса периоды
* **Подрыв доверия клиентов** из-за загадочных сбоев платежей

### Катастрофа с миграцией аккаунтов в июле 2025 г. {#the-july-2025-account-migration-disaster}

Именно такой сценарий и произошел во время нашей плановой миграции аккаунта в июле 2025 года. PayPal сначала разрешил проводить платежи, а затем внезапно заблокировал их без каких-либо уведомлений. Мы обнаружили проблему только тогда, когда клиенты начали сообщать о проблемах с оплатой.

При обращении в службу поддержки мы получили противоречивые ответы о необходимых документах, без каких-либо чётких сроков решения проблемы. Это вынудило нас полностью приостановить платежи через PayPal, что сбило с толку клиентов, у которых не было других способов оплаты.

### Почему это важно {#why-this-matters}

Подход PayPal к соблюдению требований свидетельствует о фундаментальном непонимании принципов работы компаний. Надлежащая процедура KYC должна проводиться **до** интеграции в производство, а не после того, как клиенты уже пытаются оплатить. Отсутствие проактивного взаимодействия при возникновении проблем демонстрирует оторванность PayPal от потребностей продавцов.

Этот обратный процесс является симптомом более широких организационных проблем PayPal: они отдают приоритет своим внутренним процессам, а не опыту продавцов и клиентов, что приводит к таким операционным катастрофам, которые отталкивают компании от их платформы.

## Как все остальные платежные системы делают это правильно {#how-every-other-payment-processor-does-it-right}

Функциональность листинга подписок, которую PayPal отказывается внедрять, является стандартом в отрасли уже более десятилетия. Вот как другие платёжные системы справляются с этим базовым требованием:

### Полоса {#stripe}

Stripe поддерживает листинг подписок с момента запуска своего API. В документации чётко описано, как получить все подписки для учётной записи клиента или продавца. Это считается базовой функцией CRUD.

### Paddle {#paddle}

Paddle предоставляет комплексные API для управления подписками, включая листинг, фильтрацию и пагинацию. Компания понимает, что продавцам важно видеть свои регулярные источники дохода.

### Coinbase Commerce {#coinbase-commerce}

Даже криптовалютные платежные системы, такие как Coinbase Commerce, обеспечивают лучшее управление подписками, чем PayPal.

### Квадрат {#square}

API Square включает в себя подписку как основополагающую функцию, а не как нечто второстепенное.

### Отраслевой стандарт {#the-industry-standard}

Каждый современный платежный процессор обеспечивает:

* Список всех подписок
* Фильтрация по статусу, дате, клиенту
* Разбивка на страницы для больших наборов данных
* Уведомления через веб-перехваты об изменениях в подписках
* Подробная документация с рабочими примерами

### Что предоставляют другие процессоры по сравнению с PayPal {#what-other-processors-provide-vs-paypal}

**Stripe — список всех подписок:**

```http
GET https://api.stripe.com/v1/subscriptions
Authorization: Bearer sk_test_...

Response:
{
  "object": "list",
  "data": [
    {
      "id": "sub_1MowQVLkdIwHu7ixeRlqHVzs",
      "object": "subscription",
      "status": "active",
      "customer": "cus_Na6dX7aXxi11N4",
      "current_period_start": 1679609767,
      "current_period_end": 1682288167
    }
  ],
  "has_more": false
}
```

**Stripe — Фильтр по клиенту:**

```http
GET https://api.stripe.com/v1/subscriptions?customer=cus_Na6dX7aXxi11N4
```

**Stripe — Фильтр по статусу:**

```http
GET https://api.stripe.com/v1/subscriptions?status=active
```

**PayPal — что вы на самом деле получаете:**

```http
GET https://api.paypal.com/v1/billing/subscriptions/{id}
Authorization: Bearer access_token

# You can ONLY get ONE subscription if you already know the ID
# There is NO endpoint to list all subscriptions
# There is NO way to search or filter
# You must track all subscription IDs yourself
```

**Доступные конечные точки PayPal:**

* `POST /v1/billing/subscriptions` - Создать подписку
* `GET /v1/billing/subscriptions/{id}` - Оформить ОДНУ подписку (если вы знаете ID)
* `PATCH /v1/billing/subscriptions/{id}` - Обновить подписку
* `POST /v1/billing/subscriptions/{id}/cancel` - Отменить подписку
* `POST /v1/billing/subscriptions/{id}/suspend` - Приостановить подписку

**Чего не хватает в PayPal:**

* ❌ Нет `GET /v1/billing/subscriptions` (перечислить все)
* ❌ Нет поиска
* ❌ Нет фильтрации по статусу, клиенту, дате
* ❌ Нет поддержки пагинации

PayPal — единственный крупный платежный оператор, который заставляет разработчиков вручную отслеживать идентификаторы подписок в своих собственных базах данных.

## Систематическое сокрытие информации PayPal: заглушение 6 миллионов голосов {#paypals-systematic-cover-up-silencing-6-million-voices}

В шаге, который идеально отражает подход PayPal к работе с критикой, они недавно отключили весь форум своего сообщества, фактически лишив возможности общаться более 6 миллионам участников и удалив сотни тысяч сообщений, документирующих их неудачи.

### Великое стирание {#the-great-erasure}

Первоначальное сообщество PayPal по адресу `paypal-community.com` насчитывало **6 003 558 участников** и содержало сотни тысяч сообщений, сообщений об ошибках, жалоб и обсуждений сбоев API PayPal. Это было документальное подтверждение систематических проблем PayPal за более чем десятилетие.

30 июня 2025 года PayPal без лишнего шума отключил весь форум. Все ссылки `paypal-community.com` теперь возвращают ошибку 404. Это не было миграцией или обновлением.

### Стороннее спасение {#the-third-party-rescue}

К счастью, сторонний сервис [ppl.lithium.com](https://ppl.lithium.com/) сохранил часть контента, что позволяет нам получить доступ к обсуждениям, которые PayPal пытался скрыть. Однако это стороннее сохранение неполное и может исчезнуть в любой момент.

Такая схема сокрытия улик не нова для PayPal. У них есть задокументированная история:

* Удаление критических сообщений об ошибках из публичного доступа
* Прекращение поддержки инструментов разработчика без уведомления
* Изменение API без надлежащей документации
* Запрет на обсуждение сообществом их ошибок

Закрытие форума представляет собой самую наглую попытку скрыть свои систематические провалы от общественного внимания.

## 11-летняя катастрофа с ошибкой захвата: 1899 долларов и прибыль продолжает расти {#the-11-year-capture-bug-disaster-1899-and-counting}

Пока PayPal организовывал сессии обратной связи и раздавал обещания, их основная система обработки платежей уже более 11 лет находится в состоянии полного сбоя. Свидетельства ошеломляют.

### Убыток в размере 1899 долларов США от пересылки электронного письма {#forward-emails-1899-loss}

В наших производственных системах мы обнаружили 108 платежей PayPal на общую сумму **$1899**, потерянных из-за сбоев в системе PayPal. Эти платежи демонстрируют общую закономерность:

* Получены вебхуки `CHECKOUT.ORDER.APPROVED`
* API захвата PayPal вернул ошибку 404
* Заказы стали недоступны через API PayPal

Невозможно определить, были ли списаны средства с клиентов, поскольку PayPal полностью скрывает журналы отладки по истечении 14 дней и удаляет с панели управления все данные по идентификаторам заказов, которые не были получены.

Это касается только одного предприятия. **Совокупные потери тысяч продавцов за более чем 11 лет, вероятно, составляют миллионы долларов.**

**Мы повторим это еще раз: общие потери тысяч торговцев за более чем 11 лет, вероятно, составят миллионы долларов.**

Единственная причина, по которой мы это обнаружили, заключается в том, что мы невероятно дотошны и ориентированы на данные.

### Оригинальный отчет 2013 года: более 11 лет халатности {#the-2013-original-report-11-years-of-negligence}

Самый ранний задокументированный отчет об этой конкретной проблеме находится на [Stack Overflow в ноябре 2013 г.](https://stackoverflow.com/questions/19773755/keep-receiving-404-error-with-rest-api-when-doing-a-capture) ([архивировано](https://web.archive.org/web/20250708045416/https://stackoverflow.com/questions/19773755/keep-receiving-404-error-with-rest-api-when-doing-a-capture)):

> «Продолжаю получать ошибку 404 с Rest API при выполнении захвата»

Ошибка, о которой сообщалось в 2013 году, **идентична** той, с которой Forward Email столкнулась в 2024 году:

```json
{
  "name": "INVALID_RESOURCE_ID",
  "message": "The requested resource ID was not found",
  "information_link": "https://developer.paypal.com/webapps/developer/docs/api/#INVALID_RESOURCE_ID",
  "debug_id": "e56bae98dcc26"
}
```

Реакция общества в 2013 году была показательной:

> «В настоящее время обнаружена проблема с REST API. PayPal работает над её решением».

**Прошло более 11 лет, а они всё ещё «работают над этим».**

### Допуск 2016 года: PayPal ломает свой собственный SDK {#the-2016-admission-paypal-breaks-their-own-sdk}

В 2016 году в репозитории PayPal на GitHub была обнаружена уязвимость [массовые провалы захвата](https://github.com/paypal/PayPal-PHP-SDK/issues/660), влияющая на их официальный PHP SDK. Масштабы были ошеломляющими:

> «С 20 сентября 2016 г. все попытки захвата PayPal терпят неудачу с ошибкой «INVALID_RESOURCE_ID — запрошенный идентификатор ресурса не найден». С 19 по 20 сентября никаких изменений в интеграции API не произошло. **100% попыток захвата с 20 сентября возвращают эту ошибку».

Один торговец сообщил:

> «За последние 24 часа у меня было **более 1400 неудачных попыток захвата**, все с ошибкой INVALID_RESOURCE_ID».

Первой реакцией PayPal было возложить вину на продавца и направить его в техподдержку. Только после серьёзного давления они признали свою вину:

> «У меня есть новости от наших разработчиков продукта. Они заметили, что в отправляемых заголовках PayPal-Request-ID отправляется с 42 символами, но, похоже, **недавно произошло изменение, которое ограничило этот идентификатор всего 38 символами**».

Это признание раскрывает систематическую халатность PayPal:

1. **Они внесли недокументированные критические изменения**
2. **Они сломали свой собственный официальный SDK**
3. **Они сначала обвинили продавцов**
4. **Они признали вину только под давлением**

Даже после «исправления» проблемы торговцы сообщают:

> «Обновил SDK до версии 1.7.4, но **проблема всё ещё актуальна**».

### Эскалация 2024 года: все еще не работает {#the-2024-escalation-still-broken}

Недавние отчёты сообщества PayPal, сохранившего свои данные, показывают, что проблема даже усугубилась. В [Обсуждение в сентябре 2024 г.](https://ppl.lithium.com/t5/REST-APIs/Receiving-APPROVED-Webhooks-for-Order-but-capture-leads-to-404/td-p/3176093) ([архивировано](https://web.archive.org/web/20250708045416/https://ppl.lithium.com/t5/REST-APIs/Receiving-APPROVED-Webhooks-for-Order-but-capture-leads-to-404/td-p/3176093)) описаны те же самые проблемы:

> «Проблема начала проявляться около двух недель назад и затрагивает не все заказы. **Наиболее распространённой из них, похоже, является ошибка 404 при захвате.**»

Торговец описывает ту же схему, которая наблюдалась при пересылке электронных писем:

> «После попытки перехватить заказ PayPal возвращает ошибку 404. При получении сведений о заказе: {'id': 'ID', 'intent': 'CAPTURE', 'status': 'COMPLETED', ..., 'final_capture': true, ...} **Никаких следов успешного перехвата с нашей стороны не обнаружено».

### Катастрофа надежности Webhook {#the-webhook-reliability-disaster}

Еще одна [сохраненное обсуждение сообщества](https://ppl.lithium.com/t5/REST-APIs/Not-received-PAYMENT-CAPTURE-COMPLETED-when-had-captured/m-p/3042446) показывает, что система веб-перехватов PayPal принципиально ненадежна:

> «Теоретически, должно быть два события (CHECKOUT.ORDER.APPROVED и PAYMENT.CAPTURE.COMPLETED) из события Webhook. На самом деле, **эти два события редко получаются сразу, PAYMENT.CAPTURE.COMPLETED в большинстве случаев не может быть получен или будет получен в течение нескольких часов**».

Для оплаты подписки:

> "**«ПЛАТЕЖ.ПРОДАЖА.ЗАВЕРШЕНА» иногда не приходил или получался только через несколько часов.**"

Вопросы продавца раскрывают всю глубину проблем с надежностью PayPal:

1. **«Почему это происходит?»** — Система веб-перехватов PayPal в корне не работает.
2. **«Если статус заказа «ЗАВЕРШЕН», могу ли я считать, что деньги получены?»** — Продавцы не могут доверять ответам API PayPal.
3. **«Почему в разделе «Журналы событий» -> «События веб-перехватов» нет журналов?»** — Даже собственная система журналов PayPal не работает.

### Модель систематической халатности {#the-pattern-of-systematic-negligence}

Доказательства охватывают более 11 лет и демонстрируют четкую закономерность:

* **2013**: «PayPal работает над этим»
* **2016**: PayPal признаёт наличие критических изменений и предоставляет исправление.
* **2024**: Те же самые ошибки продолжают возникать, затрагивая пересылку электронной почты и множество других функций.

Это не ошибка — **это систематическая халатность**.** PayPal знает об этих критических сбоях в обработке платежей уже более десяти лет и постоянно:

1. **Обвинили продавцов в ошибках PayPal**
2. **Внесли недокументированные критические изменения**
3. **Предоставили неэффективные исправления, которые не работают**
4. **Игнорировали финансовые последствия для бизнеса**
5. **Скрыли улики, закрыв форумы сообщества**

### Недокументированное требование {#the-undocumented-requirement}

В официальной документации PayPal нигде не упоминается, что продавцы должны реализовать логику повторных попыток для операций по сбору платежей. В документации указано, что продавцы должны «создавать транзакции сразу после подтверждения», но не упоминается, что их API случайным образом возвращает ошибки 404, требующие сложных механизмов повторных попыток.

Это заставляет каждого торговца:

* Реализация логики повторных попыток с экспоненциальным откладыванием
* Обработка несогласованной доставки веб-перехватов
* Создание сложных систем управления состоянием
* Ручной мониторинг неудачных захватов

**Все остальные платежные системы предоставляют надежные API-интерфейсы для сбора платежей, которые работают с первого раза.**

## Более общая схема обмана PayPal {#paypals-broader-pattern-of-deception}

Катастрофа с ошибкой захвата данных — всего лишь один пример систематического подхода PayPal к обману клиентов и сокрытию своих ошибок.

### Действия Департамента финансовых услуг Нью-Йорка {#the-new-york-department-of-financial-services-action}

В январе 2025 года Департамент финансовых услуг Нью-Йорка выдал ордер [принудительные меры против PayPal](https://www.dfs.ny.gov/system/files/documents/2025/01/ea20250123-paypal-inc.pdf) на мошеннические действия, продемонстрировав, что схема обмана PayPal выходит далеко за рамки их API.

Это регулирующее действие демонстрирует готовность PayPal заниматься мошенническими практиками во всем своем бизнесе, а не только в отношении инструментов разработчика.

### Иск о меде: переписывание партнерских ссылок {#the-honey-lawsuit-rewriting-affiliate-links}

Приобретение PayPal компании Honey привело к [судебные иски, утверждающие, что Honey переписывает партнерские ссылки](https://www.theverge.com/2024/12/23/24328767/honey-paypal-lawsuit-affiliate-commission-influencer) краже комиссионных у создателей контента и инфлюенсеров. Это ещё одна форма систематического мошенничества, при котором PayPal получает прибыль, перенаправляя доходы, предназначенные для других.

Закономерность ясна:

1. **Сбои API**: Скрыть неисправную функциональность, обвинить продавцов.
2. **Замалчивание сообщества**: Устранить доказательства проблем.
3. **Нарушения нормативных требований**: Использование мошеннических схем.
4. **Кража партнёрских программ**: Кража комиссий путём технических манипуляций.

### Цена халатности PayPal {#the-cost-of-paypals-negligence}

Убыток Forward Email в размере 1899 долларов — это лишь вершина айсберга. Рассмотрим более масштабные последствия:

* **Отдельные продавцы**: Тысячи теряют сотни и тысячи долларов каждый.
* **Корпоративные клиенты**: Потенциально миллионы потерянного дохода.
* **Время разработки**: Бесчисленные часы, потраченные на создание обходных путей для неисправных API PayPal.
* **Доверие клиентов**: Компании теряют клиентов из-за сбоев в платежах PayPal.

Если один небольшой сервис электронной почты потерял почти 2000 долларов США, и эта проблема существует уже более 11 лет, затронув тысячи торговцев, совокупный финансовый ущерб, вероятно, составит **сотни миллионов долларов**.

### Ложь в документации {#the-documentation-lie}

В официальной документации PayPal постоянно не упоминаются критические ограничения и ошибки, с которыми могут столкнуться продавцы. Например:

* **API захвата**: Не упоминается, что ошибки 404 встречаются часто и требуют логики повторных попыток.
* **Надёжность веб-перехватчиков**: Не упоминается, что веб-перехваты часто задерживаются на часы.
* **Включение подписки**: В документации подразумевается, что включение подписки возможно при отсутствии конечной точки.
* **Время ожидания сеанса**: Не упоминаются агрессивные 60-секундные тайм-ауты.

Такое систематическое упущение важной информации вынуждает торговцев выявлять ограничения PayPal методом проб и ошибок в производственных системах, что часто приводит к финансовым потерям.

## Что это означает для разработчиков {#what-this-means-for-developers}

Систематическое нежелание PayPal удовлетворять базовые потребности разработчиков и одновременно собирать подробную обратную связь свидетельствует о фундаментальной организационной проблеме. Они используют сбор отзывов как замену фактического решения проблем.

Закономерность ясна:

1. Разработчики сообщают о проблемах.
2. PayPal организует сеансы обратной связи с руководителями.
3. Предоставляется подробная обратная связь.
4. Команды признают пробелы и обещают «отслеживать и устранять».
5. Ничего не внедряется.
6. Руководители уходят в более успешные компании.
7. Новые команды запрашивают ту же обратную связь.
8. Цикл повторяется.

Между тем разработчикам приходится придумывать обходные пути, идти на компромиссы в сфере безопасности и иметь дело со сломанными пользовательскими интерфейсами только для того, чтобы принимать платежи.

Если вы разрабатываете платёжную систему, воспользуйтесь нашим опытом: создайте свою [тройной подход](https://forwardemail.net/en/blog/docs/building-reliable-payment-system-stripe-paypal) с несколькими процессорами, но не ждите, что PayPal предоставит вам всю необходимую базовую функциональность. С самого начала планируйте обходные пути.

> В этой публикации представлен наш 11-летний опыт работы с API PayPal в Forward Email. Все примеры кода и ссылки взяты из наших реальных рабочих систем. Мы продолжаем поддерживать платежи PayPal, несмотря на эти проблемы, поскольку у некоторых клиентов нет других вариантов.

<img загрузка="ленивый" src="/img/articles/paypal-api-issues.webp" alt="" class="rounded-lg" />